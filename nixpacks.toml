# nixpacks.toml
# Konfigurasi eksplisit untuk Nixpacks agar mengenali Python dan Node.js

packages = ["nodejs", "python3"] # Pastikan kedua paket ini diinstal

[phases.setup]
# Perintah setup yang dijalankan untuk menginstal dependensi
# Ini akan dijalankan sebelum build atau start commands
commands = [
    "python3 -m pip install -r requirements.txt", 
    "cd trapesium-frontend && npm install --no-fund --no-audit && cd ..", # --no-fund --no-audit untuk mengurangi output
]

[phases.build]
# Perintah build yang dijalankan setelah setup
commands = [
    "cd trapesium-frontend && npm run build && cd ..",
    "python3 -m manage.py collectstatic --noinput", 
]

[start]
# Perintah untuk memulai aplikasi
cmd = "gunicorn metnumtrapesium.wsgi:application --bind 0.0.0.0:$PORT"

[environments]
# Variabel lingkungan yang diperlukan
# Pastikan DJANGO_SETTINGS_MODULE diatur jika tidak di manage.py
DJANGO_SETTINGS_MODULE = "metnumtrapesium.settings"

# Atur PORT sesuai standar Railway
PORT = "$PORT"

# Jika Anda perlu variabel DB_URL
# DATABASE_URL = "$DATABASE_URL"
